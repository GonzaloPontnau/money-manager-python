{% extends "base.html" %}
{% load static %}

{% block title %}Detalle de Transferencia - Money Manager{% endblock %}

{% block content %}
<div class="dashboard-container" style="max-width: 800px; margin: 0 auto;">
    <h1>Detalle de Transferencia</h1>
    
    <div class="actions-toolbar">
        <a href="{% url 'finanzas:lista_transferencias' %}" class="btn btn-secondary btn-sm">
            <i class="fas fa-arrow-left"></i> Volver
        </a>
        
        {% if es_emisor and transferencia.estado == 'pending' %}
        <form method="post" action="{% url 'finanzas:cancelar_transferencia' transferencia.uuid %}" style="margin-left: auto;">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('¿Estás seguro de que quieres cancelar esta transferencia?');">
                <i class="fas fa-circle-xmark"></i> Cancelar transferencia
            </button>
        </form>
        {% endif %}
    </div>
    
    <div class="transferencia-detail">
        <!-- Status Header -->
        <div class="estado-header {{ transferencia.estado }}">
            <span class="estado-badge">
                {% if transferencia.estado == 'completed' %}
                    <i class="fas fa-check-circle mr-2"></i>Transferencia Completada
                {% elif transferencia.estado == 'pending' %}
                    <i class="fas fa-clock mr-2"></i>Transferencia Pendiente
                {% elif transferencia.estado == 'failed' %}
                    <i class="fas fa-circle-xmark mr-2"></i>Transferencia Fallida
                {% elif transferencia.estado == 'cancelled' %}
                    <i class="fas fa-ban mr-2"></i>Transferencia Cancelada
                {% endif %}
            </span>
        </div>
        
        <!-- Main Info -->
        <div class="transferencia-info">
            <div class="info-section monto-section 
                 {% if es_emisor %}gasto{% else %}ingreso{% endif %}">
                <span class="label">Monto</span>
                <span class="valor monto">
                    {% if es_emisor %}-{% else %}+{% endif %}{{ transferencia.monto }}
                </span>
            </div>
            
            <div class="info-section">
                <span class="label">Referencia</span>
                <span class="valor">{{ transferencia.referencia }}</span>
            </div>
            
            <div class="info-section">
                <span class="label">Concepto</span>
                <span class="valor">{{ transferencia.concepto|default:"Sin concepto" }}</span>
            </div>
            
            <!-- Participants -->
            <div class="transfer-participants">
                <div class="emisor">
                    <div class="user-icon">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="user-info">
                        <span class="user-label">De</span>
                        <span class="username">{{ transferencia.emisor.username }}</span>
                        {% if es_emisor %}<span class="self-tag">Tú</span>{% endif %}
                    </div>
                </div>
                
                <div class="transfer-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
                
                <div class="receptor">
                    <div class="user-icon">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="user-info">
                        <span class="user-label">Para</span>
                        <span class="username">{{ transferencia.receptor.username }}</span>
                        {% if not es_emisor %}<span class="self-tag">Tú</span>{% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Metadata -->
        <div class="transferencia-metadata">
            <div class="info-section">
                <span class="label">ID de Transferencia</span>
                <span class="valor" style="font-size: 0.8rem; opacity: 0.7;">{{ transferencia.uuid }}</span>
            </div>
            
            <div class="info-section">
                <span class="label">Fecha de creación</span>
                <span class="valor">{{ transferencia.fecha_creacion|date:"d/m/Y H:i:s" }}</span>
            </div>
            
            {% if transferencia.fecha_procesamiento %}
            <div class="info-section">
                <span class="label">Fecha de procesamiento</span>
                <span class="valor">{{ transferencia.fecha_procesamiento|date:"d/m/Y H:i:s" }}</span>
            </div>
            {% endif %}
            
            {% if transferencia.mensaje_respuesta %}
            <div class="info-section">
                <span class="label">Mensaje del sistema</span>
                <span class="valor mensaje-sistema">{{ transferencia.mensaje_respuesta }}</span>
            </div>
            {% endif %}
        </div>
        
        {% if transferencia.estado == 'completed' %}
        <div class="success-message">
            <i class="fas fa-check-circle mr-2"></i>
            La transferencia se completó correctamente.
        </div>
        {% elif transferencia.estado == 'failed' %}
        <div class="message error" style="border-radius: 0; margin: 0; border: none; border-left: none;">
            <i class="fas fa-circle-exclamation mr-2"></i>
            La transferencia no pudo completarse.
        </div>
        {% elif transferencia.estado == 'cancelled' %}
        <div class="warning-message">
            <i class="fas fa-triangle-exclamation mr-2"></i>
            La transferencia fue cancelada.
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
